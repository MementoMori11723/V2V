<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta name="description" content="Voice to Voice" />
    <meta name="keywords" content="Voice to Voice" />
    <meta name="author" content="Voice to Voice" />
    <title>Echo Flow</title>
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com" />
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />

    <style>
      /* General Reset */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Poppins", Arial, sans-serif;
      }

      /* Body and Main Layout to Center Container and Stick Footer */
      body {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        background: linear-gradient(135deg, #ecba82, #f2a65a);
        color: #353238;
        transition:
          background 0.3s,
          color 0.3s;
        overflow-x: hidden;
      }

      main {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      /* Dark Mode */
      body.dark-mode {
        background: linear-gradient(135deg, #353238, #2e2a27);
        color: #ecba82;
      }

      /* Navbar Styling */
      .nav-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
      }

      .logo {
        font-size: 1.5em;
        font-weight: 700;
      }

      .logo a {
        text-decoration: none;
        color: inherit;
      }

      .menu-items {
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .menu-items a {
        color: inherit;
        text-decoration: none;
        font-size: 1em;
        transition: color 0.3s;
      }

      /* Hamburger Menu Icon */
      .hamburger {
        display: none;
        font-size: 1.5em;
        background: none;
        border: none;
        color: inherit;
        cursor: pointer;
        transition: transform 0.3s ease;
      }

      .hamburger.open i::before {
        content: "\f00d";
        /* Font Awesome 'X' icon */
      }

      /* Sidebar Overlay */
      .sidebar-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        opacity: 0;
        z-index: 998;
        transition: opacity 0.3s ease;
      }

      .sidebar-overlay.show {
        display: block;
        opacity: 1;
      }

      /* Sidebar Menu */
      .sidebar {
        position: fixed;
        top: 0;
        right: -250px;
        width: 250px;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        color: #ecba82;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 20px;
        transition: right 0.3s ease;
        z-index: 999;
        padding: 20px;
      }

      .sidebar.show {
        right: 0;
        /* Slide in the sidebar */
      }

      .sidebar a {
        color: #ecba82;
        text-decoration: none;
        font-size: 1.2em;
        transition: color 0.3s;
      }

      .sidebar .toggle-switch {
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
      }

      /* Toggle Switch Styling */
      .toggle-switch {
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
      }

      .toggle-switch input[type="checkbox"] {
        display: none;
      }

      .toggle-switch .slider {
        width: 40px;
        height: 20px;
        background: #ecba82;
        border-radius: 20px;
        position: relative;
        transition: background 0.3s;
      }

      .toggle-switch .slider::before {
        content: "";
        position: absolute;
        width: 18px;
        height: 18px;
        background: #353238;
        border-radius: 50%;
        top: 1px;
        left: 2px;
        transition: 0.4s;
      }

      .toggle-switch input:checked + .slider {
        background: #353238;
      }

      .toggle-switch input:checked + .slider::before {
        transform: translateX(20px);
        background: #ecba82;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .menu-items {
          display: none;
        }

        .hamburger {
          display: block;
        }
      }

      /* Main Container */

      /* Container Styling */
      .container {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        padding: 40px;
        /* Increased padding for a larger appearance */
        text-align: center;
        border: 1px solid rgba(0, 0, 0, 0.1);
        border-radius: 20px;
        box-shadow: 0px 8px 20px rgba(0, 0, 0, 0.1);
        width: 95%;
        max-width: 1000px;
        /* Further increased max-width for larger layout */
        max-height: 90vh;
        /* Increased max-height for more vertical space */
        overflow-y: auto;
        margin: auto;
      }

      /* Lighter variant for dark mode */
      body.dark-mode .container {
        background: #4e4540;
        color: #ecba82;
      }

      /* Textarea Styling */
      textarea {
        width: 100%;
        height: 80px;
        margin-bottom: 15px;
        padding: 12px;
        background: #ecba82;
        color: inherit;
        border: none;
        border-radius: 8px;
        resize: none;
        outline: none;
        font-size: 1em;
      }

      /* Placeholder Color in Light Mode */
      textarea::placeholder {
        color: #6d4c41;
        opacity: 0.8;
      }

      /* Dark Mode Textarea and Placeholder Color */
      body.dark-mode textarea {
        background: #6b5e57;
        color: #ecba82;
      }

      body.dark-mode textarea::placeholder {
        color: #ecba82;
        /* Light color for better contrast in dark mode */
        opacity: 0.8;
      }

      body.dark-mode textarea {
        background: #6b5e57;
        color: #ecba82;
      }

      /* Chat Actions */
      .action-buttons {
        display: flex;
        gap: 10px;
        width: 100%;
        justify-content: center;
        margin-bottom: 15px;
      }

      button {
        background: #f2a65a;
        color: #353238;
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1em;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
      }

      button:hover {
        background: #ecba82;
      }

      /* Result Display */
      #gpt-result {
        width: 100%;
        text-align: justify;
        font-weight: 500;
        color: inherit;
        padding: 12px;
        border-radius: 8px;
        background: #ecba82;
        border: none;
        font-size: 1em;
        margin-top: 50px;
        min-height: 80px;
      }

      body.dark-mode #gpt-result {
        background: #6b5e57;
        color: #ecba82;
      }

      /* Speak Button */
      #speak {
        margin-top: 15px;
        background: #f2a65a;
        color: #353238;
        width: 100%;
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        font-size: 1em;
        cursor: pointer;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
      }

      #speak:hover {
        background: #ecba82;
      }

      /* Error Dialog */
      dialog#error-msg {
        position: fixed;
        top: 20%;
        left: 50%;
        transform: translate(-50%, -20%);
        background: #ff495c;
        color: #ffffff;
        border: none;
        padding: 15px;
        border-radius: 12px;
        box-shadow: 0px 8px 15px rgba(0, 0, 0, 0.2);
        width: 80%;
        max-width: 300px;
        text-align: center;
        display: none;
      }

      dialog#error-msg p {
        margin-bottom: 10px;
      }

      dialog#error-msg button {
        background: transparent;
        border: none;
        color: #ffffff;
        font-size: 1em;
        cursor: pointer;
        position: absolute;
        top: 10px;
        right: 10px;
      }

      /* Footer styling */
      footer {
        text-align: center;
        padding: 15px 20px;
        background: #ecba82;
        color: #353238;
        bottom: 0;
        width: 100%;
      }

      footer a {
        color: #353238;
        margin: 0 10px;
        text-decoration: none;
        font-size: 0.9em;
        transition: color 0.3s;
      }

      body.dark-mode footer {
        background: #353238;
        color: #ecba82;
      }

      body.dark-mode footer a {
        color: #ecba82;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        nav .menu-items {
          display: none;
        }

        .hamburger {
          display: block;
        }
      }
    </style>

    <script>
      // Dark mode toggle with persistent state
      function toggleDarkMode() {
        document.body.classList.toggle("dark-mode");
        localStorage.setItem(
          "darkMode",
          document.body.classList.contains("dark-mode"),
        );

        // Sync both toggle switches with the actual dark mode state
        document
          .querySelectorAll(".toggle-switch input[type='checkbox']")
          .forEach((checkbox) => {
            checkbox.checked = document.body.classList.contains("dark-mode");
          });
      }

      // Load dark mode state from local storage and sync all toggle switches
      document.addEventListener("DOMContentLoaded", () => {
        const isDarkMode = localStorage.getItem("darkMode") === "true";
        if (isDarkMode) {
          document.body.classList.add("dark-mode");
        }

        // Sync both toggle switches (in navbar and sidebar) with the dark mode state
        document
          .querySelectorAll(".toggle-switch input[type='checkbox']")
          .forEach((checkbox) => {
            checkbox.checked = isDarkMode;
          });
      });

      // Sidebar toggle
      function toggleSidebar() {
        const sidebarOverlay = document.querySelector(".sidebar-overlay");
        const sidebar = document.querySelector(".sidebar");
        const hamburger = document.querySelector(".hamburger");

        sidebarOverlay.classList.toggle("show");
        sidebar.classList.toggle("show");
        hamburger.classList.toggle("open");
      }

      function closeSidebar() {
        const sidebarOverlay = document.querySelector(".sidebar-overlay");
        const sidebar = document.querySelector(".sidebar");
        const hamburger = document.querySelector(".hamburger");

        sidebarOverlay.classList.remove("show");
        sidebar.classList.remove("show");
        hamburger.classList.remove("open");
      }

      let isRecording = false;
      let recognition;

      function record() {
        let txtarea = document.getElementById("voice-input");
        const recordBtn = document.getElementById("record");
        window.SpeechRecognition =
          window.SpeechRecognition || window.webkitSpeechRecognition;

        if (!isRecording) {
          recognition = new SpeechRecognition();
          recognition.interimResults = true;
          recognition.lang = "en-US";
          recognition.continuous = true;
          recognition.start();
          isRecording = true;
          recordBtn.innerHTML = `<i class="fas fa-stop-circle"></i> Stop`;

          recognition.addEventListener("result", (e) => {
            const transcript = Array.from(e.results)
              .map((result) => result[0])
              .map((result) => result.transcript)
              .join("");
            txtarea.value = transcript;
          });

          recognition.addEventListener("end", () => {
            if (isRecording) {
              recognition.start();
            }
          });
        } else {
          recognition.stop();
          isRecording = false;
          recordBtn.innerHTML = `<i class="fas fa-microphone"></i> Record`;
        }
      }

      function edit() {
        let txtarea = document.getElementById("voice-input");
        txtarea.disabled = !txtarea.disabled;
      }

      function send() {
        const data = document.getElementById("voice-input").value;
        const gptResult = document.getElementById("gpt-result");
        const errorMsg = document.getElementById("error-msg");
        const audio = document.getElementById("audio");
        gptResult.innerText = "Loading...";
        fetch("/api", {
          method: "POST",
          headers: {
            "Content-Type": "text/plain",
          },
          body: data,
        })
          .then((res) => res.json())
          .then((data) => {
            if (data.error) {
              gptResult.innerText = "Result will be displayed here";
              errorMsg.querySelector("p").innerText = data.error;
              errorMsg.style.display = "block";
              return;
            }
            gptResult.innerText = data.message;
            audio.src = data.audioMessage;
          })
          .catch((err) => {
            gptResult.innerText = "Result will be displayed here";
            errorMsg.querySelector("p").innerText = `Error: ${err}`;
            errorMsg.style.display = "block";
          });
      }

      function closeErrorDialog() {
        document.getElementById("error-msg").style.display = "none";
      }

      function speak() {
        const audio = document.getElementById("audio");
        const speakBtn = document.getElementById("speak");

        if (audio.paused && audio.src) {
          audio.play();
          speakBtn.innerHTML = `<i class="fas fa-stop"></i> Stop`;

          audio.onended = () => {
            speakBtn.innerHTML = `<i class="fas fa-volume-up"></i> Speak`;
          };
        } else {
          audio.pause();
          speakBtn.innerHTML = `<i class="fas fa-volume-up"></i> Speak`;
        }
      }
    </script>
  </head>

  <body>
    <!-- Navbar -->
    <nav>
      <div class="nav-content">
        <div class="logo">
          <a href="/">Echo Flow</a>
        </div>
        <div class="menu-items">
          <a href="/">Home</a>
          <a href="/about">About</a>
          <label class="toggle-switch">
            <input type="checkbox" onchange="toggleDarkMode()" />
            <span class="slider"></span>
          </label>
        </div>
        <button class="hamburger" onclick="toggleSidebar()">
          <i class="fas fa-bars"></i>
        </button>
      </div>
    </nav>

    <!-- Sidebar Menu with Overlay -->
    <div class="sidebar-overlay" onclick="closeSidebar()"></div>
    <div class="sidebar">
      <a href="/">Home</a>
      <a href="/about">About</a>
      <label class="toggle-switch">
        <input type="checkbox" onchange="toggleDarkMode()" />
        <span class="slider"></span>
      </label>
    </div>

    <!-- Main Container -->
    <div class="container">
      <textarea
        id="voice-input"
        disabled
        placeholder="Enter your message..."
      ></textarea>
      <div class="action-buttons">
        <button onclick="edit()" id="edit">
          <i class="fas fa-edit"></i> Edit
        </button>
        <button onclick="record()" id="record">
          <i class="fas fa-microphone"></i> Record
        </button>
        <button onclick="send()" id="send">
          <i class="fas fa-paper-plane"></i> Send
        </button>
      </div>
      <p id="gpt-result">Result will be displayed here</p>
      <button onclick="speak()" id="speak">
        <i class="fas fa-volume-up"></i> Speak
      </button>
      <audio id="audio"></audio>
    </div>

    <!-- Error Dialog -->
    <dialog id="error-msg">
      <p></p>
      <button onclick="closeErrorDialog()">✖</button>
    </dialog>

    <!-- Footer -->
    <footer>
      <a href="/about#privacy-policy">Privacy Policy</a> |
      <a href="/about#terms-of-service">Terms of Service</a> |
      <a href="/about#contact-us">Contact Us</a>
    </footer>
  </body>
</html>
