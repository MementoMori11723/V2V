<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta name="description" content="Voice to Voice" />
    <meta name="keywords" content="Voice to Voice" />
    <meta name="author" content="Voice to Voice" />
    <title>Echo Flow</title>
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com" />
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />

    <style>
      .menu-items,
      .nav-content,
      body,
      main {
        display: flex;
      }

      .hamburger,
      a:focus,
      button:focus {
        box-shadow: none;
        outline: 0;
      }

      .sidebar,
      .sidebar-overlay {
        top: 0;
        height: 100%;
        position: fixed;
      }

      #speak,
      button {
        background: #f2a65a;
        padding: 10px 20px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        font-size: 1em;
        cursor: pointer;
        color: #353238;
      }

      #gpt-result,
      #speak,
      .menu-items a,
      button,
      textarea {
        font-size: 1em;
      }

      .container,
      dialog#error-msg,
      footer {
        text-align: center;
      }

      #speak,
      body,
      button,
      footer,
      footer a {
        color: #353238;
      }

      .menu-items a,
      .sidebar a,
      footer a {
        text-decoration: none;
        transition: color 0.3s;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: Poppins, Arial, sans-serif;
      }

      body {
        flex-direction: column;
        min-height: 100vh;
        background: linear-gradient(135deg, #ecba82, #f2a65a);
        transition:
          background 0.3s,
          color 0.3s;
        overflow-x: hidden;
      }

      main {
        flex: 1;
        justify-content: center;
        align-items: center;
      }

      body.dark-mode {
        background: linear-gradient(135deg, #353238, #2e2a27);
        color: #ecba82;
      }

      #gpt-result,
      #speak:hover,
      .toggle-switch .slider,
      button:hover,
      footer,
      textarea {
        background: #ecba82;
      }

      #gpt-result,
      .hamburger,
      .logo a,
      .menu-items a,
      textarea {
        color: inherit;
      }

      .nav-content {
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
      }

      .logo {
        font-size: 1.5em;
        font-weight: 700;
      }

      .logo a {
        text-decoration: none;
      }

      .menu-items {
        align-items: center;
        gap: 20px;
      }

      .hamburger {
        display: none;
        font-size: 1.5em;
        background: 0 0;
        border: none;
        padding: 0;
        margin: 0;
        cursor: pointer;
        appearance: none;
        transition: transform 0.3s;
      }

      .hamburger.open i::before {
        content: "\f00d";
      }

      .sidebar-overlay {
        left: 0;
        width: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        opacity: 0;
        z-index: 998;
        transition: opacity 0.3s;
      }

      .sidebar-overlay.show {
        display: block;
        opacity: 1;
      }

      .sidebar {
        right: -250px;
        width: 250px;
        background: rgba(0, 0, 0, 0.9);
        color: #ecba82;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 20px;
        transition: right 0.3s;
        z-index: 999;
        padding: 20px;
      }

      .sidebar.show {
        right: 0;
      }

      .sidebar a {
        color: #ecba82;
        font-size: 1.2em;
      }

      .sidebar .toggle-switch,
      .toggle-switch {
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
      }

      .toggle-switch input[type="checkbox"] {
        display: none;
      }

      .toggle-switch .slider {
        width: 40px;
        height: 20px;
        border-radius: 20px;
        position: relative;
        transition: background 0.3s;
      }

      .toggle-switch .slider::before {
        content: "";
        position: absolute;
        width: 18px;
        height: 18px;
        background: #353238;
        border-radius: 50%;
        top: 1px;
        left: 2px;
        transition: 0.4s;
      }

      .toggle-switch input:checked + .slider {
        background: #353238;
      }

      .toggle-switch input:checked + .slider::before {
        transform: translateX(20px);
        background: #ecba82;
      }

      @media (max-width: 768px) {
        .menu-items {
          display: none;
        }

        .hamburger {
          display: block;
        }
      }

      .container {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        padding: 40px;
        border: 1px solid rgba(0, 0, 0, 0.1);
        border-radius: 20px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        width: 95%;
        max-width: 1000px;
        max-height: 90vh;
        overflow-y: auto;
        margin: auto;
      }

      .action-buttons,
      textarea {
        margin-bottom: 15px;
        width: 100%;
      }

      body.dark-mode .container {
        background: #4e4540;
        color: #ecba82;
      }

      textarea {
        height: 80px;
        padding: 12px;
        border: 2px solid transparent;
        border-radius: 8px;
        resize: none;
        outline: 0;
        transition: border-color 0.3s;
      }

      textarea::placeholder {
        color: #6d4c41;
        opacity: 0.8;
      }

      body.dark-mode #gpt-result,
      body.dark-mode textarea {
        background: #6b5e57;
        color: #ecba82;
      }

      body.dark-mode textarea::placeholder {
        color: #ecba82;
        opacity: 0.8;
      }

      .editable {
        border-color: #f2a65a;
        animation: 1.5s infinite glow;
      }

      @keyframes glow {
        0%,
        100% {
          box-shadow: 0 0 5px rgba(242, 166, 90, 0.5);
        }

        50% {
          box-shadow: 0 0 20px #f2a65a;
        }
      }

      body.dark-mode .editable {
        border-color: #ecba82;
        animation: 1.5s infinite darkGlow;
      }

      @keyframes darkGlow {
        0%,
        100% {
          box-shadow: 0 0 5px rgba(236, 186, 130, 0.5);
        }

        50% {
          box-shadow: 0 0 20px #ecba82;
        }
      }

      .action-buttons {
        display: flex;
        gap: 10px;
        justify-content: center;
      }

      button {
        border: none;
        border-radius: 8px;
      }

      #gpt-result {
        width: 100%;
        text-align: justify;
        font-weight: 500;
        padding: 12px;
        border-radius: 8px;
        border: none;
        margin-top: 50px;
        min-height: 80px;
      }

      #speak {
        margin-top: 15px;
        width: 100%;
        border: none;
        border-radius: 8px;
      }

      dialog#error-msg {
        position: fixed;
        top: 20%;
        left: 50%;
        transform: translate(-50%, -20%);
        background: #ff495c;
        color: #fff;
        border: none;
        padding: 15px;
        border-radius: 12px;
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        width: 80%;
        max-width: 300px;
        display: none;
      }

      dialog#error-msg p {
        margin-bottom: 10px;
      }

      dialog#error-msg button {
        background: 0 0;
        border: none;
        color: #fff;
        font-size: 1em;
        cursor: pointer;
        position: absolute;
        top: 10px;
        right: 10px;
      }

      footer {
        padding: 15px 20px;
        bottom: 0;
        width: 100%;
      }

      footer a {
        margin: 0 10px;
        font-size: 0.9em;
      }

      body.dark-mode footer {
        background: #353238;
        color: #ecba82;
      }

      body.dark-mode footer a {
        color: #ecba82;
      }

      /* Warning Notice */
      .warning-notice {
        background-color: #fff9c4;
        /* Light yellow background */
        border: 1px solid #ffeb3b;
        /* Slightly darker yellow border */
        color: #665c00;
        /* Darker text for readability */
        padding: 15px;
        border-radius: 5px;
        font-family: Arial, sans-serif;
        margin-bottom: 30px;
        display: flex;
        align-items: center;
        text-align: justify;
      }

      .warning-notice span.icon {
        font-size: 20px;
        margin-right: 10px;
      }

      /* Dark Mode Variant */
      body.dark-mode .warning-notice {
        background-color: #5c540f;
        /* Dark background */
        border: 1px solid #ecba82;
        /* Light border */
        color: #ecba82;
        /* Light text for readability */
      }

      body.dark-mode .warning-notice span.icon {
        color: #ecba82;
        /* Icon color in dark mode */
      }
    </style>

    <script>
      function toggleDarkMode() {
        document.body.classList.toggle("dark-mode"),
          localStorage.setItem(
            "darkMode",
            document.body.classList.contains("dark-mode"),
          ),
          document
            .querySelectorAll(".toggle-switch input[type='checkbox']")
            .forEach((e) => {
              e.checked = document.body.classList.contains("dark-mode");
            });
      }
      function toggleSidebar() {
        let e = document.querySelector(".sidebar-overlay"),
          t = document.querySelector(".sidebar"),
          o = document.querySelector(".hamburger");
        e.classList.toggle("show"),
          t.classList.toggle("show"),
          o.classList.toggle("open");
      }
      function closeSidebar() {
        let e = document.querySelector(".sidebar-overlay"),
          t = document.querySelector(".sidebar"),
          o = document.querySelector(".hamburger");
        e.classList.remove("show"),
          t.classList.remove("show"),
          o.classList.remove("open");
      }
      document.addEventListener("DOMContentLoaded", () => {
        let e = "true" === localStorage.getItem("darkMode");
        e && document.body.classList.add("dark-mode"),
          document
            .querySelectorAll(".toggle-switch input[type='checkbox']")
            .forEach((t) => {
              t.checked = e;
            });
      });
      let isRecording = !1,
        recognition;
      function record() {
        let e = document.getElementById("voice-input"),
          t = document.getElementById("record");
        (window.SpeechRecognition =
          window.SpeechRecognition || window.webkitSpeechRecognition),
          isRecording
            ? (recognition.stop(),
              (isRecording = !1),
              (t.innerHTML = '<i class="fas fa-microphone"></i> Record'))
            : (((recognition = new SpeechRecognition()).interimResults = !0),
              (recognition.lang = "en-US"),
              (recognition.continuous = !0),
              recognition.start(),
              (isRecording = !0),
              (t.innerHTML = '<i class="fas fa-stop-circle"></i> Stop'),
              recognition.addEventListener("result", (t) => {
                let o = Array.from(t.results)
                  .map((e) => e[0])
                  .map((e) => e.transcript)
                  .join("");
                e.value = o;
              }),
              recognition.addEventListener("end", () => {
                isRecording && recognition.start();
              }));
      }
      function edit() {
        let e = document.getElementById("voice-input");
        (e.disabled = !e.disabled), e.classList.toggle("editable");
      }
      function send() {
        let e = document.getElementById("voice-input").value,
          t = document.getElementById("gpt-result"),
          o = document.getElementById("error-msg"),
          i = document.getElementById("audio");
        (t.innerText = "Loading..."),
          fetch("/api", {
            method: "POST",
            headers: { "Content-Type": "text/plain" },
            body: e,
          })
            .then((e) => e.json())
            .then((e) => {
              if (e.error) {
                (t.innerText = "Result will be displayed here"),
                  (o.querySelector("p").innerText = e.error),
                  (o.style.display = "block");
                return;
              }
              (t.innerText = e.message), (i.src = e.audioMessage);
            })
            .catch((e) => {
              (t.innerText = "Result will be displayed here"),
                (o.querySelector("p").innerText = `Error: ${e}`),
                (o.style.display = "block");
            });
      }
      function closeErrorDialog() {
        document.getElementById("error-msg").style.display = "none";
      }
      function speak() {
        let e = document.getElementById("audio"),
          t = document.getElementById("speak");
        e.paused && e.src
          ? (e.play(),
            (t.innerHTML = '<i class="fas fa-stop"></i> Stop'),
            (e.onended = () => {
              t.innerHTML = '<i class="fas fa-volume-up"></i> Speak';
            }))
          : (e.pause(),
            (t.innerHTML = '<i class="fas fa-volume-up"></i> Speak'));
      }
    </script>
  </head>

  <body>
    <!-- Navbar -->
    <nav aria-label="Main Navigation">
      <div class="nav-content">
        <div class="logo">
          <a href="/" aria-label="Echo Flow Home">Echo Flow</a>
        </div>
        <div class="menu-items">
          <a href="/">Home</a>
          <a href="/about">About</a>
          <label class="toggle-switch" aria-label="Toggle Dark Mode">
            <input type="checkbox" onchange="toggleDarkMode()" />
            <span class="slider"></span>
          </label>
        </div>
        <button
          class="hamburger"
          onclick="toggleSidebar()"
          aria-label="Toggle Menu"
          aria-expanded="false"
          aria-controls="sidebar"
        >
          <i class="fas fa-bars" aria-hidden="true"></i>
        </button>
      </div>
    </nav>

    <!-- Sidebar Menu with Overlay -->
    <div
      class="sidebar-overlay"
      onclick="closeSidebar()"
      aria-hidden="true"
      tabindex="-1"
    ></div>
    <div
      class="sidebar"
      id="sidebar"
      role="navigation"
      aria-label="Sidebar Menu"
    >
      <a href="/">Home</a>
      <a href="/about">About</a>
      <label class="toggle-switch" aria-label="Toggle Dark Mode">
        <input type="checkbox" onchange="toggleDarkMode()" />
        <span class="slider"></span>
      </label>
    </div>

    <!-- Main Container -->
    <main>
      <div class="container">
        <!-- Warning Notice -->
        <div class="warning-notice">
          <span class="icon">⚠️</span>
          <span
            ><strong>Notice:</strong> This content is generated by Echo Flow's
            custom gpt model, may contain false information.</span
          >
        </div>
        <textarea
          id="voice-input"
          disabled
          placeholder="Enter your message..."
          aria-label="Voice Input"
        ></textarea>
        <div class="action-buttons">
          <button onclick="edit()" id="edit" aria-label="Edit Message">
            <i class="fas fa-edit" aria-hidden="true"></i> Edit
          </button>
          <button onclick="record()" id="record" aria-label="Record Message">
            <i class="fas fa-microphone" aria-hidden="true"></i> Record
          </button>
          <button onclick="send()" id="send" aria-label="Send Message">
            <i class="fas fa-paper-plane" aria-hidden="true"></i> Send
          </button>
        </div>
        <p id="gpt-result" aria-live="polite">Result will be displayed here</p>
        <button onclick="speak()" id="speak" aria-label="Speak Result">
          <i class="fas fa-volume-up" aria-hidden="true"></i> Speak
        </button>
        <audio id="audio" aria-hidden="true"></audio>
      </div>
    </main>

    <!-- Error Dialog -->
    <dialog id="error-msg" role="alertdialog" aria-modal="true">
      <p></p>
      <button onclick="closeErrorDialog()" aria-label="Close Error Dialog">
        ✖
      </button>
    </dialog>

    <!-- Footer -->
    <footer>
      <a href="/about#privacy-policy">Privacy Policy</a> |
      <a href="/about#terms-of-service">Terms of Service</a> |
      <a href="/about#contact-us">Contact Us</a>
    </footer>
  </body>
</html>
