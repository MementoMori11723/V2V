<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <meta name="description" content="Voice to Voice" />
  <meta name="keywords" content="Voice to Voice" />
  <meta name="author" content="Voice to Voice" />
  <title>Voice to Voice Bot</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    /* General Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    /* Body styling */
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: #f0f8f5;
      color: #1d2d2a;
    }

    /* Container styling */
    .container {
      background-color: #e1f0eb;
      padding: 25px;
      width: 380px;
      text-align: center;
      border: 1px solid #c3e6d9;
      border-radius: 8px;
    }

    h1 {
      margin-bottom: 20px;
      color: #0a4d3a;
      font-size: 1.8em;
      font-weight: 600;
    }

    textarea {
      width: 100%;
      height: 100px;
      margin-bottom: 15px;
      padding: 12px;
      background-color: #f3faf7;
      color: #1d2d2a;
      border: 1px solid #c3e6d9;
      border-radius: 6px;
      resize: none;
      outline: none;
      font-size: 1em;
      transition: background-color 0.3s ease;
    }

    textarea:focus {
      background-color: #eaf6f3;
    }

    button {
      background-color: #36a079;
      color: #ffffff;
      padding: 8px 18px;
      margin: 8px 4px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9em;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #58b992;
    }

    #gpt-result {
      margin-top: 15px;
      text-align: justify;
      font-style: italic;
      color: #0a4d3a;
      min-height: 40px;
      padding: 10px;
      border-radius: 4px;
      background-color: #f3faf7;
      border: 1px solid #c3e6d9;
    }

    /* Dialog styling */
    dialog {
      background-color: #e1f0eb;
      color: #1d2d2a;
      border: 1px solid #c3e6d9;
      padding: 15px;
      text-align: left;
      width: 300px;
      border-radius: 6px;
    }

    dialog button {
      background-color: #f08080;
      padding: 5px 10px;
      border-radius: 4px;
      color: #fff;
      border: none;
    }
  </style>

  <script>
    let isRecording = false;
    let recognition;

    function record() {
      let txtarea = document.getElementById("voice-input");
      const recordBtn = document.getElementById("record");
      window.SpeechRecognition =
        window.SpeechRecognition || window.webkitSpeechRecognition;

      if (!isRecording) {
        recognition = new SpeechRecognition();
        recognition.interimResults = true;
        recognition.lang = "en-US";
        recognition.continuous = true;
        recognition.start();
        isRecording = true;
        recordBtn.innerHTML = `<i class="fas fa-stop-circle"></i> Stop`;

        recognition.addEventListener("result", (e) => {
          const transcript = Array.from(e.results)
            .map((result) => result[0])
            .map((result) => result.transcript)
            .join("");
          txtarea.value = transcript;
        });

        recognition.addEventListener("end", () => {
          if (isRecording) {
            recognition.start();
          }
        });
      } else {
        recognition.stop();
        isRecording = false;
        recordBtn.innerHTML = `<i class="fas fa-microphone"></i> Record`;
      }
    }

    function edit() {
      let txtarea = document.getElementById("voice-input");
      txtarea.disabled = !txtarea.disabled;
    }

    function send() {
      const data = document.getElementById("voice-input").value;
      const errorMsg = document.getElementById("error-msg");
      const gptResult = document.getElementById("gpt-result");
      const audio = document.getElementById("audio");
      gptResult.innerText = "Loading...";
      fetch("/api", {
        method: "POST",
        headers: {
          "Content-Type": "text/plain",
        },
        body: data,
      })
        .then((res) => res.json())
        .then((data) => {
          console.log(data);
          if (data.error) {
            gptResult.innerText = "Result will be displayed here";
            errorMsg.querySelector("p").innerText = data.error;
            errorMsg.showModal();
            return;
          }
          gptResult.innerText = data.message;
          audio.src = data.audioMessage;
        })
        .catch((err) => {
          console.error(err);
          gptResult.innerText = "Result will be displayed here";
          errorMsg.querySelector("p").innerText = `Error: ${err}`;
          errorMsg.showModal();
        });
    }

    function speak() {
      const audio = document.getElementById("audio");
      if (audio.src) {
        audio.play();
      } else {
        console.log("Speak");
      }
    }
  </script>
</head>

<body>
  <div class="container">
    <h1>Voice to Voice Bot</h1>
    <label for="voice-input"></label>
    <textarea name="voice-input" id="voice-input" disabled></textarea><br />
    <button onclick="edit()" id="edit"><i class="fas fa-edit"></i> Edit</button>
    <button onclick="record()" id="record"><i class="fas fa-microphone"></i> Record</button>
    <button type="button" onclick="send()" id="send"><i class="fas fa-paper-plane"></i> Send</button>
    <p id="gpt-result">Result will be displayed here</p>
    <button onclick="speak()"><i class="fas fa-volume-up"></i> Speak</button>
    <audio id="audio"></audio>
    <dialog id="error-msg">
      <p></p>
      <button onclick="document.getElementById('error-msg').close()">X</button>
    </dialog>
  </div>
</body>

</html>

